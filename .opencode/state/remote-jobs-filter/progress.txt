# Progress Log
PRD: remote-jobs-filter
Started: 2026-01-30

## Codebase Patterns
- Boolean settings follow three-field pattern: `fieldName`, `defaultFieldName`, `overrideFieldName`
- Settings stored in database as '1' (true) / '0' (false) / null
- Test fixtures in *.test.tsx files must include all AppSettings fields

---
<!-- Task logs below - APPEND ONLY -->

## Task - types-1
- Added `jobspyIsRemote`, `defaultJobspyIsRemote`, and `overrideJobspyIsRemote` fields to AppSettings interface
- Files changed:
  - orchestrator/src/shared/types.ts:531-533 - Added three boolean fields after jobspyLinkedinFetchDescription
  - orchestrator/src/client/pages/SettingsPage.test.tsx:100-102 - Updated test fixture with default values
- **Learnings:** Boolean settings consistently use three-field pattern (value, default, override). All test fixtures must be updated when adding new settings fields to AppSettings interface.

## Task - types-2
- Added `jobspyIsRemote` validation schema to updateSettingsSchema
- Files changed:
  - orchestrator/src/shared/settings-schema.ts:63 - Added `jobspyIsRemote: z.boolean().nullable().optional()` after jobspyLinkedinFetchDescription
- **Learnings:** Validation schemas use Zod with `.boolean().nullable().optional()` pattern for boolean settings. Schema placement follows the same order as the TypeScript types.

## Task - db-1
- Added `jobspyIsRemote` to SettingKey type union in settings repository
- Files changed:
  - orchestrator/src/server/repositories/settings.ts:31 - Added "jobspyIsRemote" to SettingKey type union after "jobspyLinkedinFetchDescription"
- **Learnings:** The SettingKey type union defines all valid setting keys that can be stored/retrieved from the database. Each new setting must be added to this type for TypeScript safety.

## Task - api-1
- Added `jobspyIsRemote` storage logic to settings API route
- Files changed:
  - orchestrator/src/server/api/routes/settings.ts:221-228 - Added storage block after jobspyLinkedinFetchDescription that converts boolean to '1'/'0' string for database storage
- **Learnings:** Settings API route follows consistent pattern: check if field exists in input, extract value with null coalescing, store using ternary conversion (val ? '1' : '0'). All boolean settings stored as strings in database.

## Task - service-1
- Added `jobspyIsRemote` retrieval logic to settings service with environment variable support
- Files changed:
  - orchestrator/src/server/services/settings.ts:172-181 - Added defaultJobspyIsRemote, overrideJobspyIsRemote, and merge logic after jobspyLinkedinFetchDescription
  - orchestrator/src/server/services/settings.ts:232-234 - Added three fields to return object
- **Learnings:** Settings service follows pattern: parse default from env var with fallback, parse override from database (checks for '1' or 'true'), merge using nullish coalescing (override ?? default). Environment variable JOBSPY_IS_REMOTE defaults to '0' (false) if not set.

## Task - jobspy-1
- Added `isRemote` parameter to JobSpy service interface and implementation
- Files changed:
  - orchestrator/src/server/services/jobspy.ts:116 - Added `isRemote?: boolean` to RunJobSpyOptions interface
  - orchestrator/src/server/services/jobspy.ts:178-180 - Added JOBSPY_IS_REMOTE environment variable passing using pattern `String(options.isRemote ?? process.env.JOBSPY_IS_REMOTE ?? "0")`
- **Learnings:** JobSpy service passes parameters to Python script via environment variables. Boolean values are converted to strings using String() function. Follows nullish coalescing pattern: option parameter ?? env var ?? default value.

## Task - pipeline-1
- Added `isRemote` parameter passing from pipeline orchestrator to JobSpy service
- Files changed:
  - orchestrator/src/server/pipeline/orchestrator.ts:189 - Added `const jobspyIsRemoteSetting = settings.jobspyIsRemote;` to read setting from database
  - orchestrator/src/server/pipeline/orchestrator.ts:206-209 - Added `isRemote` parameter to runJobSpy() call with conversion: `jobspyIsRemoteSetting === "1"`
- **Learnings:** Pipeline orchestrator reads all settings at once via `getAllSettings()` to avoid sequential DB calls. Boolean settings stored as '1'/'0' strings in database are converted using strict equality check `=== "1"`. Follows same pattern as linkedinFetchDescription: check for non-null/undefined, then convert. The ternary pattern `setting !== null && setting !== undefined ? setting === "1" : undefined` ensures undefined is passed when setting is not set, allowing downstream defaults to apply.

## Task - python-1
- Added `is_remote` parameter to Python scraper script with JOBSPY_IS_REMOTE environment variable support
- Files changed:
  - extractors/jobspy/scrape_jobs.py:42 - Added `is_remote = _env_bool("JOBSPY_IS_REMOTE", False)` after linkedin_fetch_description
  - extractors/jobspy/scrape_jobs.py:61 - Added `is_remote=is_remote` parameter to scrape_jobs() function call
- **Learnings:** Python script uses `_env_bool()` helper function to parse boolean environment variables with default fallback. Parameters are passed directly to the JobSpy library's scrape_jobs() function. The JobSpy library handles unsupported parameters gracefully (sites that don't support remote filtering will ignore it silently).

## Task - ui-settings
- Added `isRemote` field to JobspyValues type with EffectiveDefault<boolean> structure
- Updated SettingsPage.tsx to include jobspyIsRemote in all form handling:
  - Added to DEFAULT_FORM_VALUES (null)
  - Added to NULL_SETTINGS_PAYLOAD (null)
  - Added to mapSettingsToForm (data.overrideJobspyIsRemote)
  - Added to getDerivedSettings with default false values
  - Added to form submission payload with nullIfSame logic
- Added Remote Jobs checkbox to JobspySection.tsx after Fetch LinkedIn Description checkbox
  - Uses Controller pattern with react-hook-form
  - Label: "Remote Jobs?"
  - Description: "Only search for remote job listings"
  - Displays effective and default values
- Updated test fixtures in JobspySection.test.tsx to include isRemote field
- Files changed:
  - orchestrator/src/client/pages/settings/types.ts:27 - Added isRemote to JobspyValues
  - orchestrator/src/client/pages/SettingsPage.tsx:58,98,131,278-281,586-590 - Added jobspyIsRemote to form handling and getDerivedSettings
  - orchestrator/src/client/pages/settings/components/JobspySection.tsx:152,428-460 - Added checkbox UI with effective/default display
  - orchestrator/src/client/pages/settings/components/JobspySection.test.tsx:17,34 - Updated test fixture
- **Learnings:** UI checkbox components follow consistent pattern: Controller wrapper, checked state with default fallback, onCheckedChange with !!checked coercion, and effective/default value display. Form submission uses nullIfSame to only store values different from defaults.

## Task - ui-badge
- Added Remote badge to JobHeader component that displays when job.isRemote === true
- Badge positioned next to Source badge in job header
- Uses Badge component with outline variant, consistent styling with Source badge
- Badge only displays when job.isRemote is strictly true (not for false or null)
- Files changed:
  - orchestrator/src/client/components/JobHeader.tsx:207-215 - Added conditional Remote badge rendering after Source badge
- **Learnings:** Badge components follow simple conditional rendering pattern. Using strict equality (=== true) ensures badge only shows for explicitly remote jobs, not for null/undefined values. Badge styling kept consistent with existing badges by reusing the same className pattern.

## Task - docs-1
- Added JOBSPY_IS_REMOTE environment variable documentation to .env.example
- Created new JobSpy section following the format of existing sections (UKVisaJobs)
- Documentation includes clear description: "Filter for remote-only jobs (default: 0 = disabled)"
- Variable is commented out by default: # JOBSPY_IS_REMOTE=0
- Files changed:
  - .env.example:31-35 - Added JobSpy section with JOBSPY_IS_REMOTE documentation
- **Learnings:** .env.example follows structured sections with headers delimited by === lines. New variables should be commented out by default with clear descriptions of their purpose and default values. JobSpy variables were not previously documented in .env.example, so this creates the first JobSpy section in the file.
